import{$ as e,B as t,C as n,Ct as r,Et as i,H as a,J as o,K as s,L as c,M as l,Q as u,R as d,S as f,St as ee,T as p,U as m,V as h,at as g,bt as _,et as v,it as y,k as b,mt as x,nt as S,ot as C,q as w,rt as T,st as E,tt as D,w as O,x as k,xt as A,z as j}from"./BUwZQTr6.js";import{h as M}from"./_v7-ePgP.js";import{t as N}from"./Bxfoq5Is.js";import{t as P}from"./BaYFa2sV.js";import{A as F,b as I,g as L,h as R,i as te,k as z,l as B,m as V,u as H,v as U,x as W,y as ne}from"./BNAMIMxA.js";import{g as G,v as K}from"./CE_dLVT9.js";import{n as q,t as re}from"./BjXhW6l8.js";import{t as J}from"./BWNecmep.js";import{t as Y}from"./CsZCIw88.js";import{l as X}from"./D2kYZRJ8.js";var Z={class:`text-md flex items-center gap-1 font-bold whitespace-nowrap uppercase sm:text-xl`},Q=o({__name:`LogoText`,setup(e){let r=n(),i=j(()=>!!r.currentEndpoint);return(e,n)=>{let r=f;return S(),m(`div`,Z,[w(r,{class:`bg-linear-to-br from-primary to-secondary bg-clip-text text-transparent`,to:_(i)?`/`:`/setup`},{default:E(()=>[...n[0]||=[s(` metacube `,-1)]]),_:1},8,[`to`]),n[1]||=t(`span`,null,`(`,-1),n[2]||=t(`a`,{class:`text-primary transition-transform hover:scale-125 hover:rotate-90`,href:`https://github.com/metacubex/metacubexd`,target:`_blank`},` xd `,-1),n[3]||=t(`span`,null,`)`,-1)])}}}),ie=Object.assign(Q,{__name:`LogoText`}),ae={class:`dropdown dropdown-end`},oe={tabindex:`0`,role:`button`,class:`btn btn-circle btn-ghost`,"aria-label":`Change language`},se={tabindex:`0`,class:`dropdown-content menu z-50 mt-2 w-40 rounded-box bg-base-200 p-2 shadow-lg`},ce=[`onClick`],le=o({__name:`LangSwitcher`,setup(e){let{locale:n,locales:i,setLocale:a}=k(),o=j(()=>i.value.map(e=>typeof e==`string`?{code:e,name:e}:e));return(e,i)=>(S(),m(`div`,ae,[t(`div`,oe,[w(_(L),{size:20})]),t(`ul`,se,[(S(!0),m(c,null,T(_(o),e=>(S(),m(`li`,{key:e.code},[t(`button`,{class:A({"menu-active":_(n)===e.code}),onClick:t=>_(a)(e.code)},r(e.name),11,ce)]))),128))])]))}}),ue=Object.assign(le,{__name:`LangSwitcher`}),de={class:`drawer drawer-end w-auto`},fe={class:`drawer-content flex items-center`},pe={for:`themes`,class:`drawer-button btn btn-circle btn-sm btn-primary`},me={class:`drawer-side overflow-x-hidden`},he={class:`menu gap-2 rounded-l-box bg-base-300 p-2`},ge=[`data-theme`,`onClick`],_e=o({__name:`ThemeSwitcher`,setup(e){let n=N();function i(e){n.curTheme=e}return(e,n)=>(S(),m(`div`,de,[n[1]||=t(`input`,{id:`themes`,type:`checkbox`,class:`drawer-toggle`},null,-1),t(`div`,fe,[t(`label`,pe,[w(_(V))])]),t(`div`,me,[n[0]||=t(`label`,{for:`themes`,class:`drawer-overlay`},null,-1),t(`ul`,he,[(S(!0),m(c,null,T(_(M),e=>(S(),m(`li`,{key:e,"data-theme":e,class:`btn btn-xs`,onClick:t=>i(e)},r(e),9,ge))),128))])])]))}}),ve=Object.assign(_e,{__name:`ThemeSwitcher`}),ye={class:`fixed inset-x-0 bottom-0 z-50 border-t border-base-content/10 bg-base-300/95 backdrop-blur-sm lg:hidden`},be={class:`grid h-16 grid-cols-6`},xe={key:0,class:`absolute top-0 left-1/2 h-1 w-8 -translate-x-1/2 transform rounded-b-full bg-primary`},Se={key:1,class:`text-xs font-medium text-primary`},Ce=o({__name:`MobileBottomNav`,props:{navItems:{}},setup(e){let n=b(),i=e=>n.path===e;v(()=>{o(),window.addEventListener(`resize`,o)}),D(()=>{document.body.style.paddingBottom=`0`,window.removeEventListener(`resize`,o)});function o(){document.body.style.paddingBottom=window.innerWidth<1024?`4rem`:`0`}return(n,o)=>{let s=f;return S(),m(`nav`,ye,[t(`div`,be,[(S(!0),m(c,null,T(e.navItems,e=>(S(),h(s,{key:e.href,to:e.href,class:`relative flex flex-col items-center justify-center gap-1 transition-all duration-200 hover:bg-base-200/50`},{default:E(()=>[i(e.href)?(S(),m(`div`,xe)):a(``,!0),t(`div`,{class:A([`text-xl transition-all duration-200`,{"scale-110 text-primary":i(e.href),"text-base-content/70":!i(e.href)}])},[(S(),h(g(e.icon)))],2),i(e.href)?(S(),m(`span`,Se,r(e.name),1)):a(``,!0)]),_:2},1032,[`to`]))),128))])])}}}),we=Object.assign(Ce,{__name:`MobileBottomNav`}),Te={class:`navbar z-50 flex w-auto items-center justify-center bg-base-300 px-4 shadow-lg`},Ee={class:`navbar-start`},De={key:0,class:`navbar-center hidden lg:flex`},Oe={class:`menu menu-horizontal gap-2 menu-lg p-0`},ke=[`data-tip`],Ae={class:`navbar-end gap-1`},je=o({__name:`Header`,setup(e){let n=b(),{t:r}=k(),i=j(()=>[{href:`/overview`,name:r(`overview`),icon:U},{href:`/proxies`,name:r(`proxies`),icon:I},{href:`/rules`,name:r(`rules`),icon:H},{href:`/connections`,name:r(`connections`),icon:R},{href:`/logs`,name:r(`logs`),icon:W},{href:`/config`,name:r(`config`),icon:B}]);return(e,r)=>{let o=ie,s=f,l=ue,u=ve,d=we;return S(),m(c,null,[t(`header`,Te,[t(`div`,Ee,[w(o)]),_(n).path===`/setup`?a(``,!0):(S(),m(`nav`,De,[t(`ul`,Oe,[(S(!0),m(c,null,T(_(i),e=>(S(),m(`li`,{key:e.href,class:`tooltip tooltip-bottom`,"data-tip":e.name},[w(s,{to:e.href,class:`rounded-box`,"active-class":`menu-active`},{default:E(()=>[(S(),h(g(e.icon)))]),_:2},1032,[`to`])],8,ke))),128))])])),t(`div`,Ae,[r[0]||=t(`div`,{id:`header-traffic-indicator`,class:`flex items-center`},null,-1),w(l),w(u)])]),_(n).path===`/setup`?a(``,!0):(S(),h(d,{key:0,"nav-items":_(i)},null,8,[`nav-items`]))],64)}}}),Me=Object.assign(je,{__name:`Header`});const Ne=globalThis.setInterval;function Pe(){let e=n(),t=q(),r=P(),i=J(),a=N(),o=null,s=null,c=null,l=null,u=null,d=(t,n)=>{let r=e.currentEndpoint;if(!r)return null;let i=e.wsEndpointURL,a=r.secret,o=new URLSearchParams;a&&o.set(`token`,a);let s=new WebSocket(`${i}/${t}?${o.toString()}`);return s.onmessage=e=>{try{n(JSON.parse(e.data))}catch{}},s.onerror=e=>{console.error(`WebSocket error for ${t}:`,e)},s};return{connect:()=>{if(G()){let e=K();t.updateFromWsMsg({connections:e.mockConnections,uploadTotal:e.mockTrafficStats.up,downloadTotal:e.mockTrafficStats.down}),r.setLatestTraffic(e.mockTrafficStats),r.setLatestMemory(e.mockMemory);let n=Date.now(),a=e.mockConnections.length;for(let t=30;t>=0;t--){let i=n-t*1e3,o=e.mockTrafficStats.down+Math.floor(Math.random()*1e5)-5e4,s=e.mockTrafficStats.up+Math.floor(Math.random()*2e4)-1e4,c=e.mockMemory.inuse+Math.floor(Math.random()*5e6)-25e5,l=a+Math.floor(Math.random()*10)-5;r.addTrafficDataPoint(i,o,s),r.addMemoryDataPoint(i,c),r.addConnectionCountDataPoint(i,l)}e.mockLogs.forEach(e=>{i.addLog(e)}),u=Ne(()=>{let t=Date.now(),n={up:e.mockTrafficStats.up+Math.floor(Math.random()*1e4),down:e.mockTrafficStats.down+Math.floor(Math.random()*5e4)};r.setLatestTraffic(n),r.addTrafficDataPoint(t,n.down,n.up);let i={inuse:e.mockMemory.inuse+Math.floor(Math.random()*5e6)-25e5,oslimit:e.mockMemory.oslimit};r.setLatestMemory(i),r.addMemoryDataPoint(t,i.inuse);let a=e.mockConnections.length+Math.floor(Math.random()*10)-5;r.addConnectionCountDataPoint(t,a)},1e3);return}o=d(`connections`,e=>{let n=e;if(t.updateFromWsMsg(n),n){let e=n.connections?.length??0;r.addConnectionCountDataPoint(Date.now(),e)}}),s=d(`traffic`,e=>{let t=e;r.setLatestTraffic(t),r.addTrafficDataPoint(Date.now(),t.down,t.up)}),c=d(`memory`,e=>{let t=e;r.setLatestMemory(t),r.addMemoryDataPoint(Date.now(),t.inuse)});let n=e.currentEndpoint;if(n){let t=e.wsEndpointURL,r=new URLSearchParams;n.secret&&r.set(`token`,n.secret),r.set(`level`,a.logLevel),l=new WebSocket(`${t}/logs?${r.toString()}`),l.onmessage=e=>{try{let t=JSON.parse(e.data);i.addLog(t)}catch{}}}},disconnect:()=>{u&&=(clearInterval(u),null),o?.close(),s?.close(),c?.close(),l?.close(),o=null,s=null,c=null,l=null},reconnectLogs:()=>{l?.close();let t=e.currentEndpoint;if(t){let n=e.wsEndpointURL,r=new URLSearchParams;t.secret&&r.set(`token`,t.secret),r.set(`level`,a.logLevel),l=new WebSocket(`${n}/logs?${r.toString()}`),l.onmessage=e=>{try{let t=JSON.parse(e.data);i.addLog(t)}catch{}}}}}}var Fe={class:`hidden`},Ie=o({__name:`ProtectedResources`,setup(e){let{connect:t,disconnect:n,reconnectLogs:r}=Pe(),i=N();return v(()=>{t()}),D(()=>{n()}),C(()=>i.logLevel,()=>{r()}),(e,t)=>(S(),m(`div`,Fe))}}),Le=Object.assign(Ie,{__name:`ProtectedResources`}),Re=i(Y(),1),ze={class:`flex items-center gap-1`},Be={class:`font-mono text-xs`},Ve={class:`flex items-center gap-1`},He={class:`font-mono text-xs`},Ue={class:`flex items-center gap-1`},We={class:`font-mono text-xs`},Ge={class:`flex items-center gap-1`},Ke={class:`font-mono text-xs`},qe=[`title`],Je={class:`flex flex-col gap-2 p-3`},Ye={class:`flex items-center justify-between gap-2`},Xe={class:`text-xs font-semibold uppercase opacity-60`},Ze={class:`flex items-center gap-1`},Qe=[`title`],$e=[`title`],et={class:`grid grid-cols-2 gap-x-4 gap-y-1 text-xs`},tt={class:`flex items-center gap-1.5`},$={class:`font-mono font-medium`},nt={class:`flex items-center gap-1.5`},rt={class:`font-mono font-medium`},it={class:`flex items-center gap-1.5 opacity-70`},at={class:`font-mono`},ot={class:`flex items-center gap-1.5 opacity-70`},st={class:`font-mono`},ct=o({__name:`GlobalTrafficIndicator`,setup(n){let i=P(),o=q(),s=N(),f=O(`globalTrafficIndicatorVisible`,!0),p=O(`globalTrafficIndicatorCollapsed`,!1),g=O(`globalTrafficIndicatorPosition`,{x:-1,y:-1}),y=x(!1),b=x({x:0,y:0}),T=x(null),D=x(null),k,M=j(()=>i.latestTraffic?.down??0),I=j(()=>i.latestTraffic?.up??0),L=j(()=>i.latestMemory?.inuse??0),R=j(()=>o.latestConnectionMsg?.connections?.length??0),B=e=>re(e).toString(),V=j(()=>g.value.x===-1||g.value.y===-1?{right:`16px`,bottom:`16px`}:{left:`${g.value.x}px`,top:`${g.value.y}px`});function H(){f.value=!f.value}function U(){p.value=!p.value}function W(){p.value=!1,g.value={x:-1,y:-1}}function G(e){if(!T.value)return;y.value=!0;let t=T.value.getBoundingClientRect(),n=`touches`in e?e.touches[0].clientX:e.clientX,r=`touches`in e?e.touches[0].clientY:e.clientY;b.value={x:n-t.left,y:r-t.top},g.value.x===-1&&(g.value.x=t.left,g.value.y=t.top),document.addEventListener(`mousemove`,K),document.addEventListener(`mouseup`,J),document.addEventListener(`touchmove`,K),document.addEventListener(`touchend`,J)}function K(e){if(!y.value)return;let t=`touches`in e?e.touches[0].clientX:e.clientX,n=`touches`in e?e.touches[0].clientY:e.clientY,r=t-b.value.x,i=n-b.value.y,a=T.value?.getBoundingClientRect(),o=a?.width||200,s=a?.height||150;r=Math.max(0,Math.min(window.innerWidth-o,r)),i=Math.max(0,Math.min(window.innerHeight-s,i)),g.value.x=r,g.value.y=i}function J(){y.value&&(y.value=!1,document.removeEventListener(`mousemove`,K),document.removeEventListener(`mouseup`,J),document.removeEventListener(`touchmove`,K),document.removeEventListener(`touchend`,J))}function Y(){if(!D.value)return;k&&=(k.destroy(),void 0);let e=X(),t=D.value.offsetWidth||200;k=Re.default.chart(D.value,{chart:{type:`areaspline`,backgroundColor:`transparent`,spacing:[0,0,0,0],margin:[0,0,0,0],animation:!1,width:t,height:48},credits:{enabled:!1},accessibility:{enabled:!1},title:{text:void 0},legend:{enabled:!1},xAxis:{visible:!1,type:`datetime`},yAxis:{visible:!1,min:0},tooltip:{enabled:!1},plotOptions:{areaspline:{lineWidth:1.5,marker:{enabled:!1},fillOpacity:.2,animation:!1}},series:[{type:`areaspline`,name:`Download`,color:e.seriesColors[0],data:i.trafficChartHistory.download.length>0?[...i.trafficChartHistory.download].slice(-30):[[Date.now(),0]]},{type:`areaspline`,name:`Upload`,color:e.seriesColors[1],data:i.trafficChartHistory.upload.length>0?[...i.trafficChartHistory.upload].slice(-30):[[Date.now(),0]]}]})}function Z(){if(!k)return;let e=[...i.trafficChartHistory.download].slice(-30),t=[...i.trafficChartHistory.upload].slice(-30);k.series[0]?.setData(e,!1),k.series[1]?.setData(t,!0)}C(()=>i.latestTraffic,e=>{e&&(k?Z():D.value&&f.value&&!p.value&&Y())}),C(()=>s.curTheme,()=>{D.value&&!p.value&&f.value&&Y()}),C(p,e=>{!e&&f.value?u(()=>{setTimeout(()=>{D.value&&i.latestTraffic&&Y()},50)}):e&&k&&(k.destroy(),k=void 0)}),C(f,e=>{e&&!p.value?u(()=>{setTimeout(()=>{D.value&&i.latestTraffic&&Y()},50)}):!e&&k&&(k.destroy(),k=void 0)});let Q=x(!1);return v(()=>{u(()=>{Q.value=!!document.getElementById(`header-traffic-indicator`)}),f.value&&!p.value&&i.latestTraffic&&setTimeout(()=>{D.value&&Y()},100)}),e(()=>{k&&=(k.destroy(),void 0)}),(e,n)=>(S(),m(c,null,[_(Q)?(S(),h(d,{key:0,to:`#header-traffic-indicator`},[_(f)&&_(p)&&_(i).latestTraffic?(S(),m(`div`,{key:0,class:`rounded-btn flex cursor-pointer items-center gap-2 bg-base-100/50 px-2 py-1 transition-colors hover:bg-base-100`,onClick:W},[t(`div`,ze,[w(_(F),{class:`size-3 text-success`}),t(`span`,Be,r(B(_(M)))+`/s`,1)]),n[0]||=t(`div`,{class:`h-3 w-px bg-base-content/20`},null,-1),t(`div`,Ve,[w(_(z),{class:`size-3 text-info`}),t(`span`,He,r(B(_(I)))+`/s`,1)])])):a(``,!0)])):a(``,!0),_(f)&&_(p)&&_(i).latestTraffic&&!_(Q)?(S(),m(`div`,{key:1,class:`fixed right-4 bottom-4 z-50 flex cursor-pointer items-center gap-2 rounded-box bg-base-200 px-3 py-2 shadow-lg`,onClick:W},[t(`div`,Ue,[w(_(F),{class:`size-3 text-success`}),t(`span`,We,r(B(_(M)))+`/s`,1)]),n[1]||=t(`div`,{class:`h-3 w-px bg-base-content/20`},null,-1),t(`div`,Ge,[w(_(z),{class:`size-3 text-info`}),t(`span`,Ke,r(B(_(I)))+`/s`,1)])])):a(``,!0),_(f)?a(``,!0):(S(),m(`button`,{key:2,class:`btn fixed right-4 bottom-4 z-50 btn-circle shadow-lg btn-sm btn-primary`,title:e.$t(`showTrafficIndicator`),onClick:H},[w(_(z),{class:`size-4`})],8,qe)),w(l,{"enter-active-class":`transition-all duration-300 ease-out`,"enter-from-class":`opacity-0 scale-95`,"enter-to-class":`opacity-100 scale-100`,"leave-active-class":`transition-all duration-200 ease-in`,"leave-from-class":`opacity-100 scale-100`,"leave-to-class":`opacity-0 scale-95`},{default:E(()=>[_(f)&&!_(p)&&_(i).latestTraffic?(S(),m(`div`,{key:0,ref_key:`containerRef`,ref:T,class:A([`fixed z-50 min-w-56 rounded-box bg-base-200 shadow-lg select-none`,{"cursor-grabbing":_(y)}]),style:ee(_(V))},[t(`div`,Je,[t(`div`,Ye,[t(`div`,{class:`flex cursor-grab items-center gap-1 active:cursor-grabbing`,onMousedown:G,onTouchstart:G},[w(_(ne),{class:`size-4 opacity-40`}),t(`span`,Xe,r(e.$t(`traffic`)),1)],32),t(`div`,Ze,[t(`button`,{class:`btn btn-circle btn-ghost btn-xs`,title:e.$t(`hideTrafficIndicator`),onClick:U},[...n[2]||=[t(`span`,{class:`text-xs`},`âˆ’`,-1)]],8,Qe),t(`button`,{class:`btn btn-circle btn-ghost btn-xs`,title:e.$t(`hideTrafficIndicator`),onClick:H},[w(_(te),{class:`size-3`})],8,$e)])]),t(`div`,{ref_key:`chartContainer`,ref:D,class:`h-12 w-full`},null,512),t(`div`,et,[t(`div`,tt,[w(_(F),{class:`size-3 text-success`}),t(`span`,$,r(B(_(M)))+`/s `,1)]),t(`div`,nt,[w(_(z),{class:`size-3 text-info`}),t(`span`,rt,r(B(_(I)))+`/s `,1)]),t(`div`,it,[t(`span`,null,r(e.$t(`memory`))+`:`,1),t(`span`,at,r(B(_(L))),1)]),t(`div`,ot,[t(`span`,null,r(e.$t(`connections`))+`:`,1),t(`span`,st,r(_(R)),1)])])])],6)):a(``,!0)]),_:1})],64))}}),lt=Object.assign(ct,{__name:`GlobalTrafficIndicator`}),ut=[`data-theme`],dt={class:`flex-1 overflow-y-auto p-2 sm:p-4`},ft=o({__name:`default`,setup(e){let r=N(),i=n(),o=P(),s=x(null);C(s,e=>{e&&(o.rootElement=e)}),C([()=>r.autoSwitchTheme,p()],([e,t])=>{e&&(r.curTheme=t?r.favNightTheme:r.favDayTheme)},{immediate:!0}),C(()=>r.curTheme,e=>{document.documentElement.setAttribute(`data-theme`,e)},{immediate:!0});let c=j(()=>G()||!!i.currentEndpoint);return(e,n)=>{let i=Me,o=Le,l=lt;return S(),m(`div`,{ref_key:`rootElement`,ref:s,class:A([`relative flex h-screen flex-col overscroll-y-none bg-base-100 subpixel-antialiased`,_(r).enableTwemoji?`font-twemoji`:`font-default`]),"data-theme":_(r).curTheme},[w(i),t(`div`,dt,[y(e.$slots,`default`)]),_(c)?(S(),h(o,{key:0})):a(``,!0),_(c)?(S(),h(l,{key:1})):a(``,!0)],10,ut)}}});export{ft as default};