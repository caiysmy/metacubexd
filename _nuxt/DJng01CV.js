import{A as e,B as t,C as n,Ct as r,D as i,F as a,H as o,I as s,J as c,K as l,L as u,U as d,bt as f,ct as p,et as m,ft as h,k as g,mt as _,nt as v,q as y,rt as b,st as x,x as S,z as C}from"./BUwZQTr6.js";import{s as w}from"./_v7-ePgP.js";import{i as T}from"./BNAMIMxA.js";import{n as E}from"./CE_dLVT9.js";import{f as ee}from"./D2kYZRJ8.js";import{t as te}from"./BAU4SYdC.js";var D=[];for(let e=0;e<256;++e)D.push((e+256).toString(16).slice(1));function O(e,t=0){return(D[e[t+0]]+D[e[t+1]]+D[e[t+2]]+D[e[t+3]]+`-`+D[e[t+4]]+D[e[t+5]]+`-`+D[e[t+6]]+D[e[t+7]]+`-`+D[e[t+8]]+D[e[t+9]]+`-`+D[e[t+10]]+D[e[t+11]]+D[e[t+12]]+D[e[t+13]]+D[e[t+14]]+D[e[t+15]]).toLowerCase()}var k,A=new Uint8Array(16);function j(){if(!k){if(typeof crypto>`u`||!crypto.getRandomValues)throw Error(`crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported`);k=crypto.getRandomValues.bind(crypto)}return k(A)}var M={randomUUID:typeof crypto<`u`&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function N(e,t,n){e||={};let r=e.random??e.rng?.()??j();if(r.length<16)throw Error(`Random bytes length must be >= 16`);if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){if(n||=0,n<0||n+16>t.length)throw RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[n+e]=r[e];return t}return O(r)}function P(e,t,n){return M.randomUUID&&!t&&!e?M.randomUUID():N(e,t,n)}var F=P,I={class:`mx-auto flex h-full w-full max-w-screen-sm flex-col items-center justify-center gap-6 p-4`},L={class:`flex flex-col items-center gap-2`},R={class:`text-sm text-base-content/60`},z={class:`flex w-full flex-col gap-4`},B={class:`fieldset`},V={class:`label`,for:`url`},H={id:`defaultEndpoints`},U=[`value`],W=[`value`],G=[`value`],K=[`value`],q={class:`fieldset`},J={class:`label`,for:`secret`},Y={class:`grid w-full grid-cols-2 gap-4`},X=[`onClick`],Z={class:`truncate`},Q=c({__name:`setup`,setup(c){let{t:D}=S();i({title:C(()=>D(`setup`))});let O=e(),k=g(),A=n(),j=h({url:``,secret:``}),M=_(!1),N=C(()=>typeof window>`u`?``:window.__METACUBEXD_CONFIG__?.defaultBackendURL||`http://127.0.0.1:9090`),P=C(()=>typeof window>`u`?``:window.location.origin);function Q(e){A.setSelectedEndpoint(e),O.replace(`/overview`)}async function ne(e){let t=A.endpointList.find(t=>t.id===e);t&&await E(t.url,t.secret)&&Q(e)}async function $(){M.value=!0;try{let e=j.url,t=j.secret,n=ee(e);if(!await E(n,t)){M.value=!1;return}let r=F(),i=[...A.endpointList],a=i.find(e=>e.url===n);if(!a){A.setEndpointList([{id:r,url:n,secret:t},...i]),Q(r);return}a.secret=t,a.id=r,A.setEndpointList(i),Q(r)}finally{M.value=!1}}function re(e){A.removeEndpoint(e)}return m(async()=>{let e=k.query||(typeof window<`u`?new URLSearchParams(window.location.search):null);if(e&&typeof e==`object`){let t=e.hostname;if(t){j.url=`${e.http?`http:`:e.https?`https:`:typeof window<`u`?window.location.protocol:`http:`}//${t}${e.port?`:${e.port}`:``}`,j.secret=e.secret||``,await $();return}}A.endpointList.length===0&&(j.url=N.value,j.secret=``,await $())}),(e,n)=>{let i=te;return v(),d(`div`,I,[t(`div`,L,[n[2]||=t(`div`,{class:`text-3xl font-bold uppercase sm:text-4xl`},[t(`span`,{class:`bg-linear-to-br from-primary to-secondary bg-clip-text text-transparent`},` metacube `),t(`span`,null,`(`),t(`a`,{class:`inline-block text-primary transition-transform hover:scale-125 hover:rotate-90`,href:`https://github.com/metacubex/metacubexd`,target:`_blank`},` xd `),t(`span`,null,`)`)],-1),t(`p`,R,r(f(D)(`setupDescription`)),1)]),t(`form`,{class:`contents`,onSubmit:s($,[`prevent`])},[t(`div`,z,[t(`fieldset`,B,[t(`label`,V,[t(`span`,null,r(f(D)(`endpointURL`)),1)]),p(t(`input`,{id:`url`,"onUpdate:modelValue":n[0]||=e=>f(j).url=e,type:`url`,class:`input w-full`,placeholder:`http(s)://{hostname}:{port}`,list:`defaultEndpoints`,autocomplete:`on`},null,512),[[a,f(j).url]]),t(`datalist`,H,[t(`option`,{value:f(w)},null,8,U),f(N)&&f(N)!==f(`http://127.0.0.1:9090`)?(v(),d(`option`,{key:0,value:f(N)},null,8,W)):o(``,!0),f(P)&&f(P)!==f(`http://127.0.0.1:9090`)?(v(),d(`option`,{key:1,value:f(P)},null,8,G)):o(``,!0),(v(!0),d(u,null,b(f(A).endpointList,e=>(v(),d(`option`,{key:e.id,value:e.url},null,8,K))),128))])]),n[3]||=t(`input`,{type:`text`,name:`username`,autocomplete:`username`,class:`hidden`,"aria-hidden":`true`,tabindex:`-1`},null,-1),t(`fieldset`,q,[t(`label`,J,[t(`span`,null,r(f(D)(`secret`)),1)]),p(t(`input`,{id:`secret`,"onUpdate:modelValue":n[1]||=e=>f(j).secret=e,type:`password`,class:`input w-full`,placeholder:`secret`,autocomplete:`current-password`},null,512),[[a,f(j).secret]])]),y(i,{type:`submit`,class:`uppercase btn-primary`,loading:f(M)},{default:x(()=>[l(r(f(D)(`add`)),1)]),_:1},8,[`loading`])])],32),t(`div`,Y,[(v(!0),d(u,null,b(f(A).endpointList,e=>(v(),d(`div`,{key:e.id,class:`badge flex w-full cursor-pointer items-center justify-between gap-4 py-4 badge-info`,onClick:t=>ne(e.id)},[t(`span`,Z,r(e.url),1),y(i,{class:`btn-circle text-white btn-ghost btn-xs`,onClick:s(t=>re(e.id),[`stop`])},{default:x(()=>[y(f(T))]),_:1},8,[`onClick`])],8,X))),128))])])}}});export{Q as default};